---
import { getCategories, PRIORITY_CATEGORIES } from '../lib/data';

const allCategories = await getCategories();

// Map untuk akses cepat dan menyimpan urutan
const categoryMap = new Map();
allCategories.forEach(cat => {
  categoryMap.set(cat.name.toLowerCase(), cat);
});

// Urutkan kategori berdasarkan list prioritas yang sudah terpusat
const categories = PRIORITY_CATEGORIES
  .map(name => categoryMap.get(name.toLowerCase()))
  .filter(Boolean);
---


<header id="main-header" class="fixed w-full top-0 z-50 bg-black text-white shadow-md">
  <!-- Top Bar: Logo + Utility Icons -->
  <div class="border-b border-gray-800">
    <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex flex-col justify-center">
        <div class="text-xl md:text-2xl font-serif font-bold tracking-tighter leading-none text-white">
          KOMPAS<span class="text-orange-500">.com</span>
        </div>
        <span class="text-[8px] md:text-[9px] text-gray-400 tracking-[0.2em] uppercase mt-0.5 hidden md:block">Jernih Melihat Dunia</span>
      </a>

      <!-- Utility Icons -->
      <div class="flex items-center gap-2 md:gap-4">
        <!-- Search Icon (Mobile) -->
        <button id="mobile-search-btn" class="md:hidden p-2 text-gray-300 hover:text-white transition-colors" aria-label="Search">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
        </button>

        <!-- Search Bar (Desktop) -->
        <div class="hidden md:flex flex-1 max-w-md">
          <form action="/search" method="get" class="relative w-full">
            <input 
              type="text" 
              name="q"
              placeholder="Cari tokoh, topik atau peristiwa" 
              class="w-full bg-[#1F1F1F] text-gray-200 text-sm rounded px-4 py-2 border border-gray-700 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 placeholder-gray-500 transition-all" 
            />
            <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
            </button>
          </form>
        </div>

        <!-- Menu Icon -->
        <button class="p-2 text-gray-300 hover:text-white transition-colors" aria-label="Menu">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation Bar -->
  <div class="bg-black border-b border-gray-800">
    <div class="max-w-7xl mx-auto px-4">
      <nav class="overflow-x-auto md:overflow-visible no-scrollbar">
        <ul class="flex items-center gap-4 md:gap-6 whitespace-nowrap text-xs md:text-sm font-medium h-10 md:h-11">
          <li><a href="/" class="text-white hover:text-orange-500 transition-colors">Terpopuler</a></li>
          {categories.map((category) => (
            <li class="relative group h-full flex items-center">
              <div class="flex items-center gap-1 py-2 md:py-3 h-full">
                <a 
                  href={`/category/${category.slug}`} 
                  class="text-gray-300 hover:text-orange-500 transition-colors"
                >
                  {category.name}
                </a>
                {category.children && category.children.length > 0 && (
                  <svg class="w-2.5 h-2.5 text-gray-500 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                )}
              </div>
              
              {category.children && category.children.length > 0 && (
                <div class="absolute top-full left-0 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-[60] pt-2">
                  <ul class="bg-black border border-gray-800 shadow-2xl py-2 min-w-[200px] border-t-2 border-t-orange-500 rounded-b-md">
                    {category.children.map((child) => (
                      <li>
                        <a 
                          href={`/category/${child.slug}`} 
                          class="block px-4 py-2.5 text-xs text-gray-400 hover:bg-gray-900 hover:text-white transition-colors border-b border-gray-900 last:border-0"
                        >
                          {child.name}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </li>
          ))}
        </ul>
      </nav>
    </div>
  </div>
</header>

<!-- Mobile Search Overlay -->
<div id="mobile-search-overlay" class="fixed inset-0 bg-black z-50 hidden md:hidden">
  <div class="flex flex-col h-full">
    <!-- Search Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-800">
      <h2 class="text-white font-bold text-lg">Pencarian</h2>
      <button id="close-search-btn" class="p-2 text-gray-300 hover:text-white transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
    </div>
    
    <!-- Search Form -->
    <div class="p-4">
      <form action="/search" method="get" class="relative">
        <input 
          type="text" 
          name="q"
          id="mobile-search-input"
          placeholder="Cari tokoh, topik atau peristiwa..." 
          class="w-full bg-[#1F1F1F] text-white text-base rounded-lg px-4 py-3 pr-12 border border-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 placeholder-gray-500" 
          autofocus
        />
        <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
        </button>
      </form>
    </div>

    <!-- Search Suggestions (Optional) -->
    <div class="flex-1 overflow-y-auto p-4">
      <p class="text-gray-400 text-sm">Mulai ketik untuk mencari berita...</p>
    </div>
  </div>
</div>

<style>
  /* Hide scrollbar for Chrome, Safari and Opera */
  .no-scrollbar::-webkit-scrollbar {
      display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .no-scrollbar {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
  }
</style>

<script>
  const mobileSearchBtn = document.getElementById('mobile-search-btn');
  const closeSearchBtn = document.getElementById('close-search-btn');
  const searchOverlay = document.getElementById('mobile-search-overlay');
  const searchInput = document.getElementById('mobile-search-input');

  // Open search overlay
  mobileSearchBtn?.addEventListener('click', () => {
    searchOverlay?.classList.remove('hidden');
    // Focus input after a short delay to ensure it's visible
    setTimeout(() => searchInput?.focus(), 100);
  });

  // Close search overlay
  closeSearchBtn?.addEventListener('click', () => {
    searchOverlay?.classList.add('hidden');
  });

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !searchOverlay?.classList.contains('hidden')) {
      searchOverlay?.classList.add('hidden');
    }
  });
</script>
